workspace(name = "io_bazel_rules_raze")

git_repository(
    name = "io_bazel_rules_rust",
    commit = "0d0693267ba3d338230bae204bbdbfd20da0366e",
    remote = "https://github.com/mfarrugi/rules_rust.git",
)

load("@io_bazel_rules_rust//rust:repositories.bzl", "rust_repositories")

rust_repositories()

load("//complicated_cargo_library_remote:crates.bzl", "complicated_fetch_remote_crates")

complicated_fetch_remote_crates()

# Override rust protobuf to fix generated file directory
# https://github.com/stepancheg/rust-protobuf/issues/189
new_git_repository(
    name = "custom_rust_protobuf",
    build_file = "third_party/custom_rust_protobuf.BUILD",
    commit = "1cd65f58202fd5ab66c9bf60e8194692d8a59313",
    remote = "https://github.com/acmcarther/rust-protobuf.git",
)

# Override rust grpc compiler for the same reason
new_git_repository(
    name = "custom_rust_grpc_compiler",
    build_file = "third_party/custom_rust_grpc_compiler.BUILD",
    commit = "121cd4534004fa8d80845f6629698a6032e38d49",
    remote = "https://github.com/acmcarther/grpc-rs.git",
)

## Fetch GRPC (old version, due to rust grpc incompat)
# https://github.com/pingcap/grpc-rs/issues/110
new_git_repository(
    name = "com_github_grpc_grpc",
    build_file = "third_party/grpc.BUILD",
    remote = "https://github.com/grpc/grpc",
    tag = "v1.7.2",
)

load("//tools/bazel-ext:grpc.bzl", "old_grpc_repositories")

old_grpc_repositories()

git_repository(
    name = "org_pubref_rules_protobuf",
    commit = "91daba1e655805180744cd5a86a6c0095d280b65",
    remote = "https://github.com/pubref/rules_protobuf",
)

load("@org_pubref_rules_protobuf//protobuf:rules.bzl", "proto_repositories")

proto_repositories()
